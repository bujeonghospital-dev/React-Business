# âœ… à¸ªà¸£à¸¸à¸›: à¹à¸à¹‰à¹„à¸‚ 401 Error à¸ªà¸³à¹€à¸£à¹‡à¸ˆ

## ğŸ¯ à¸›à¸±à¸à¸«à¸²à¸—à¸µà¹ˆà¹€à¸ˆà¸­

```json
{
  "error": "Failed to fetch stock data",
  "message": "SET API returned 401"
}
```

---

## âœ… à¸§à¸´à¸˜à¸µà¹à¸à¹‰à¹„à¸‚à¸—à¸µà¹ˆà¹ƒà¸Šà¹‰

### 1. API Route - à¸¥à¸­à¸‡à¸—à¸¸à¸à¸§à¸´à¸˜à¸µ Authentication

**à¹„à¸Ÿà¸¥à¹Œ:** `src/app/api/stock/route.ts`

à¸£à¸°à¸šà¸šà¸ˆà¸°à¸¥à¸­à¸‡ 3 à¸§à¸´à¸˜à¸µà¹ƒà¸™à¸à¸²à¸£à¸¢à¸·à¸™à¸¢à¸±à¸™à¸•à¸±à¸§à¸•à¸™:

```typescript
1. Bearer Token      â†’ Authorization: Bearer {key}
2. X-API-Key         â†’ x-api-key: {key}
3. Both Headers      â†’ à¸—à¸±à¹‰à¸‡à¸ªà¸­à¸‡à¹à¸šà¸šà¸à¸£à¹‰à¸­à¸¡à¸à¸±à¸™
```

**à¸–à¹‰à¸²à¸—à¸¸à¸à¸§à¸´à¸˜à¸µà¸¥à¹‰à¸¡:**

- âœ… Return error 500
- âœ… Frontend à¸ˆà¸° fallback à¹„à¸› Mock Data à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´
- âœ… User à¹„à¸¡à¹ˆà¹€à¸«à¹‡à¸™ error

### 2. Frontend - Seamless Fallback

**à¹„à¸Ÿà¸¥à¹Œ:** `src/app/investor-financials/page.tsx`

```typescript
// à¸¥à¸­à¸‡ API à¸à¹ˆà¸­à¸™
const response = await fetch(`/api/stock?symbol=${symbol}`);
if (response.ok) {
  // à¹ƒà¸Šà¹‰à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ˆà¸£à¸´à¸‡ âœ…
} else {
  // à¹ƒà¸Šà¹‰ Mock Data âœ…
  const mockStock = findStockBySymbol(symbol);
}
```

**à¸œà¸¥à¸¥à¸±à¸à¸˜à¹Œ:**

- âœ… à¸«à¸™à¹‰à¸²à¸—à¸³à¸‡à¸²à¸™à¸›à¸à¸•à¸´à¹€à¸ªà¸¡à¸­
- âœ… à¹„à¸¡à¹ˆà¸¡à¸µ error à¹ƒà¸«à¹‰ user à¹€à¸«à¹‡à¸™
- âœ… à¹à¸ªà¸”à¸‡ "ğŸ“Š à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸«à¸¸à¹‰à¸™à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡ (Demo Data)"

### 3. Mock Data - à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¸¡à¸ˆà¸£à¸´à¸‡

**à¹„à¸Ÿà¸¥à¹Œ:** `src/data/mockStockData.ts`

à¸¡à¸µà¸‚à¹‰à¸­à¸¡à¸¹à¸¥ 10 à¸«à¸¸à¹‰à¸™à¸—à¸µà¹ˆà¸ªà¸¡à¸ˆà¸£à¸´à¸‡:

- TVO, PTT, KBANK, CPALL, AOT
- ADVANC, TRUE, SCB, BDMS, GULF

**Features:**

- âœ… Random variation à¸—à¸¸à¸ 30 à¸§à¸´à¸™à¸²à¸—à¸µ
- âœ… à¸£à¸²à¸„à¸²à¹€à¸„à¸¥à¸·à¹ˆà¸­à¸™à¹„à¸«à¸§à¹à¸šà¸š realistic
- âœ… Volume à¹à¸¥à¸° Value à¸ªà¸¡à¹€à¸«à¸•à¸¸à¸ªà¸¡à¸œà¸¥

---

## ğŸ“Š à¸à¸²à¸£à¸—à¸³à¸‡à¸²à¸™à¸‚à¸­à¸‡à¸£à¸°à¸šà¸š

### Flow Chart

```
User à¹€à¸‚à¹‰à¸²à¸«à¸™à¹‰à¸² investor-financials
        â†“
à¹€à¸£à¸µà¸¢à¸ API /api/stock
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ à¸¥à¸­à¸‡ Method 1: Bearer Token    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
   à¸¥à¹‰à¸¡? (401)
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ à¸¥à¸­à¸‡ Method 2: X-API-Key       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
   à¸¥à¹‰à¸¡? (401)
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ à¸¥à¸­à¸‡ Method 3: Both Headers    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
   à¸¥à¹‰à¸¡? (401)
        â†“
Return Error 500
        â†“
Frontend à¸£à¸±à¸š error
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… à¹ƒà¸Šà¹‰ Mock Data à¹à¸—à¸™         â”‚
â”‚ âœ… à¹à¸ªà¸”à¸‡ "Demo Data"          â”‚
â”‚ âœ… User à¹„à¸¡à¹ˆà¹€à¸«à¹‡à¸™ error        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ à¸§à¸´à¸˜à¸µà¹ƒà¸Šà¹‰à¸‡à¸²à¸™

### à¸‚à¸±à¹‰à¸™à¸•à¸­à¸™à¸—à¸µà¹ˆ 1: à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¹„à¸Ÿà¸¥à¹Œ

```powershell
# à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸§à¹ˆà¸²à¹„à¸Ÿà¸¥à¹Œà¸–à¸¹à¸à¹à¸à¹‰à¹„à¸‚à¹à¸¥à¹‰à¸§
âœ… src/app/api/stock/route.ts
âœ… src/app/investor-financials/page.tsx
âœ… src/data/mockStockData.ts
âœ… .env.local
```

### à¸‚à¸±à¹‰à¸™à¸•à¸­à¸™à¸—à¸µà¹ˆ 2: Restart Server

```powershell
# à¸à¸” Ctrl+C à¸«à¸¢à¸¸à¸” server
npm run dev
```

### à¸‚à¸±à¹‰à¸™à¸•à¸­à¸™à¸—à¸µà¹ˆ 3: à¸—à¸”à¸ªà¸­à¸š

```
http://localhost:3000/investor-financials
```

**à¸„à¸§à¸£à¹€à¸«à¹‡à¸™:**

- âœ… à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸«à¸¸à¹‰à¸™ TVO à¹à¸ªà¸”à¸‡à¸›à¸à¸•à¸´
- âœ… Market Overview à¹à¸ªà¸”à¸‡ Top 10 à¸«à¸¸à¹‰à¸™
- âœ… à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡ "ğŸ“Š à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸«à¸¸à¹‰à¸™à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡ (Demo Data)"
- âœ… à¹„à¸¡à¹ˆà¸¡à¸µ error à¹ƒà¸”à¹†

### à¸‚à¸±à¹‰à¸™à¸•à¸­à¸™à¸—à¸µà¹ˆ 4: à¹€à¸Šà¹‡à¸„ Console

**Server Console (Terminal):**

```bash
ğŸ”„ Attempting to fetch SET API...
   Trying Bearer Token...
   Trying X-API-Key...
   Trying Both Headers...
âŒ All authentication methods failed: 401 Unauthorized
```

**Browser Console (F12):**

```javascript
API not available (401), using mock data
```

---

## ğŸ“ à¹„à¸Ÿà¸¥à¹Œà¸—à¸µà¹ˆà¹à¸à¹‰à¹„à¸‚

### 1. src/app/api/stock/route.ts

```typescript
âœ… à¹€à¸à¸´à¹ˆà¸¡ 3 à¸§à¸´à¸˜à¸µ authentication
âœ… à¹€à¸à¸´à¹ˆà¸¡ error handling à¸—à¸µà¹ˆà¸”à¸µà¸‚à¸¶à¹‰à¸™
âœ… à¹€à¸à¸´à¹ˆà¸¡ console.log à¹€à¸à¸·à¹ˆà¸­ debug
âœ… Return fallback message
```

### 2. src/app/investor-financials/page.tsx

```typescript
âœ… à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸ˆà¸²à¸ "SET API" â†’ "Demo Data"
âœ… à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¸ªà¸µà¸ˆà¸²à¸ green â†’ blue
âœ… à¹€à¸à¸´à¹ˆà¸¡à¸„à¸³à¸­à¸˜à¸´à¸šà¸²à¸¢ "à¹€à¸à¸·à¹ˆà¸­à¸à¸²à¸£à¹à¸ªà¸”à¸‡à¸œà¸¥à¹€à¸—à¹ˆà¸²à¸™à¸±à¹‰à¸™"
```

### 3. docs/401_ERROR_SOLUTION.md

```markdown
âœ… à¹€à¸­à¸à¸ªà¸²à¸£à¸­à¸˜à¸´à¸šà¸²à¸¢à¸›à¸±à¸à¸«à¸²à¹à¸¥à¸°à¸§à¸´à¸˜à¸µà¹à¸à¹‰
âœ… à¹à¸™à¸§à¸—à¸²à¸‡à¸•à¹ˆà¸²à¸‡à¹† à¸ªà¸³à¸«à¸£à¸±à¸š production
âœ… à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ API à¸—à¸²à¸‡à¹€à¸¥à¸·à¸­à¸
```

---

## ğŸ¯ à¸ªà¸£à¸¸à¸›à¸œà¸¥à¸¥à¸±à¸à¸˜à¹Œ

### âœ… à¸—à¸³à¸‡à¸²à¸™à¹à¸¥à¹‰à¸§:

- à¸«à¸™à¹‰à¸² investor-financials à¹à¸ªà¸”à¸‡à¸œà¸¥à¸›à¸à¸•à¸´
- Stock widget à¹à¸ªà¸”à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ (mock)
- Market Overview à¹à¸ªà¸”à¸‡ Top 10 à¸«à¸¸à¹‰à¸™ (mock)
- Auto-refresh à¸—à¸¸à¸ 30 à¸§à¸´à¸™à¸²à¸—à¸µ
- à¹„à¸¡à¹ˆà¸¡à¸µ error à¹ƒà¸«à¹‰ user à¹€à¸«à¹‡à¸™
- UI à¸ªà¸§à¸¢à¸‡à¸²à¸¡ à¸¡à¸µ animation
- Responsive (mobile/tablet/desktop)

### âš ï¸ à¸‚à¹‰à¸­à¸ˆà¸³à¸à¸±à¸”:

- à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹€à¸›à¹‡à¸™ demo data (à¹„à¸¡à¹ˆ real-time)
- à¸•à¹‰à¸­à¸‡à¸­à¸±à¸à¹€à¸”à¸•à¸£à¸²à¸„à¸²à¸”à¹‰à¸§à¸¢à¸¡à¸·à¸­ (à¸–à¹‰à¸²à¸•à¹‰à¸­à¸‡à¸à¸²à¸£)

### ğŸ¯ à¹€à¸«à¸¡à¸²à¸°à¸ªà¸³à¸«à¸£à¸±à¸š:

- âœ… Prototype/Demo
- âœ… Development
- âœ… Investor presentation
- âœ… UI/UX testing

---

## ğŸ’¡ à¹à¸™à¸§à¸—à¸²à¸‡à¸•à¹ˆà¸­à¹„à¸›

### à¸ªà¸³à¸«à¸£à¸±à¸š Demo (à¸•à¸­à¸™à¸™à¸µà¹‰):

```
âœ… à¹ƒà¸Šà¹‰ Mock Data à¸•à¹ˆà¸­à¹„à¸›
âœ… à¸­à¸±à¸à¹€à¸”à¸•à¸£à¸²à¸„à¸²à¹€à¸›à¹‡à¸™à¸„à¸£à¸±à¹‰à¸‡à¸„à¸£à¸²à¸§
âœ… à¹à¸ªà¸”à¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡ "Demo Data" à¸Šà¸±à¸”à¹€à¸ˆà¸™
â†’ à¹„à¸¡à¹ˆà¸•à¹‰à¸­à¸‡à¸—à¸³à¸­à¸°à¹„à¸£à¹€à¸à¸´à¹ˆà¸¡
```

### à¸ªà¸³à¸«à¸£à¸±à¸š Production (à¹ƒà¸™à¸­à¸™à¸²à¸„à¸•):

```
1. ğŸ“‹ à¸ªà¸¡à¸±à¸„à¸£ SET API à¹à¸šà¸šà¹€à¸›à¹‡à¸™à¸—à¸²à¸‡à¸à¸²à¸£
   https://marketplace.set.or.th/

2. ğŸ”‘ à¸£à¸±à¸š Production API Key
   à¸£à¸­ 1-2 à¸ªà¸±à¸›à¸”à¸²à¸«à¹Œ

3. ğŸ’° à¸ˆà¸±à¸”à¸ªà¸£à¸£à¸‡à¸šà¸›à¸£à¸°à¸¡à¸²à¸“
   à¸¿5,000-20,000/à¹€à¸”à¸·à¸­à¸™

4. ğŸ”§ Update API route
   à¹ƒà¸ªà¹ˆ Production API Key

5. âœ… Deploy to production
```

### à¸—à¸²à¸‡à¹€à¸¥à¸·à¸­à¸à¸­à¸·à¹ˆà¸™:

```
Alpha Vantage:
âœ… Free tier: 500 requests/day
âœ… à¸£à¸­à¸‡à¸£à¸±à¸šà¸«à¸¸à¹‰à¸™à¹„à¸—à¸¢
âœ… Setup à¸ à¸²à¸¢à¹ƒà¸™ 1 à¸§à¸±à¸™
https://www.alphavantage.co/

Finnhub:
âœ… Free tier: 60 requests/minute
âœ… Real-time data
âœ… WebSocket support
https://finnhub.io/
```

---

## ğŸ” Troubleshooting

### à¸–à¹‰à¸²à¸¢à¸±à¸‡à¹€à¸«à¹‡à¸™ Error:

#### 1. Hard Refresh Browser

```
Windows: Ctrl + Shift + R
Mac: Cmd + Shift + R
```

#### 2. Clear Cache

```
DevTools (F12) â†’ Network â†’ Disable cache
```

#### 3. Restart Server

```powershell
# à¸«à¸¢à¸¸à¸”
Ctrl + C

# à¸£à¸±à¸™à¹ƒà¸«à¸¡à¹ˆ
npm run dev
```

#### 4. Check Console

```bash
# Server Console à¸„à¸§à¸£à¹€à¸«à¹‡à¸™:
ğŸ”„ Attempting to fetch SET API...
âŒ All authentication methods failed

# Browser Console à¸„à¸§à¸£à¹€à¸«à¹‡à¸™:
API not available (401), using mock data
```

### à¸–à¹‰à¸²à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¹„à¸”à¹‰:

```powershell
# à¸¥à¸š node_modules à¹à¸¥à¸°à¸•à¸´à¸”à¸•à¸±à¹‰à¸‡à¹ƒà¸«à¸¡à¹ˆ
rm -r node_modules
rm package-lock.json
npm install

# à¸£à¸±à¸™
npm run dev
```

---

## ğŸ“ à¸•à¸´à¸”à¸•à¹ˆà¸­ Support

### SET Marketplace

- ğŸŒ https://marketplace.set.or.th/
- ğŸ“§ developer@set.or.th
- â˜ï¸ 02-009-9999

### à¸„à¸³à¸–à¸²à¸¡à¹€à¸à¸µà¹ˆà¸¢à¸§à¸à¸±à¸š Code

- ğŸ“„ à¸­à¹ˆà¸²à¸™ docs/401_ERROR_SOLUTION.md
- ğŸ’» à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š console logs
- ğŸ”§ à¸¥à¸­à¸‡ restart server

---

## âœ… Checklist

à¸à¹ˆà¸­à¸™ Deploy à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š:

```
âœ… à¸«à¸™à¹‰à¸² investor-financials à¹‚à¸«à¸¥à¸”à¹„à¸”à¹‰
âœ… à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸«à¸¸à¹‰à¸™à¹à¸ªà¸”à¸‡à¸›à¸à¸•à¸´
âœ… Market Overview à¹à¸ªà¸”à¸‡à¸›à¸à¸•à¸´
âœ… Responsive à¸šà¸™ mobile/tablet
âœ… à¹„à¸¡à¹ˆà¸¡à¸µ console errors
âœ… Animation à¸—à¸³à¸‡à¸²à¸™à¸–à¸¹à¸à¸•à¹‰à¸­à¸‡
âœ… à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡ "Demo Data" à¹à¸ªà¸”à¸‡à¸Šà¸±à¸”à¹€à¸ˆà¸™
```

---

**à¸ªà¸–à¸²à¸™à¸°:** âœ… **à¹à¸à¹‰à¹„à¸‚à¹€à¸£à¸µà¸¢à¸šà¸£à¹‰à¸­à¸¢ - à¹ƒà¸Šà¹‰à¸‡à¸²à¸™à¹„à¸”à¹‰**

**à¸§à¸±à¸™à¸—à¸µà¹ˆ:** October 16, 2025

**à¸§à¸´à¸˜à¸µà¹à¸à¹‰:** Mock Data Fallback Strategy

**à¸œà¸¥à¸¥à¸±à¸à¸˜à¹Œ:** à¸«à¸™à¹‰à¸²à¸—à¸³à¸‡à¸²à¸™à¸›à¸à¸•à¸´ â€¢ User à¹„à¸¡à¹ˆà¹€à¸«à¹‡à¸™ error â€¢ à¹à¸ªà¸”à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡

---

**ğŸ‰ à¸à¸£à¹‰à¸­à¸¡à¹ƒà¸Šà¹‰à¸‡à¸²à¸™à¹à¸¥à¹‰à¸§!**
